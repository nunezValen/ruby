<div class="container py-4">
  <div class="row">
    <!-- SIDEBAR: Filtros -->
    <div class="col-lg-3 mb-4">
      <div class="card shadow-sm filter-sidebar">
        <div class="card-header bg-dark text-white">
          <strong>üîç Filtrar productos</strong>
        </div>
        <div class="card-body">
          <%= form_with url: storefront_path, method: :get, local: true do |f| %>
            <div class="mb-3">
              <label class="form-label small">T√≠tulo del √°lbum</label>
              <%= text_field_tag :title, params[:title], class: "form-control form-control-sm", placeholder: "Buscar t√≠tulo..." %>
            </div>

            <div class="mb-3">
              <label class="form-label small">Artista</label>
              <%= text_field_tag :artist, params[:artist], class: "form-control form-control-sm", placeholder: "Buscar artista..." %>
            </div>

            <div class="mb-3">
              <label class="form-label small">G√©nero</label>
              <%= select_tag :genre_id, options_from_collection_for_select(@genres, :id, :name, params[:genre_id]), include_blank: "Todos los g√©neros", class: "form-select form-select-sm" %>
            </div>

            <div class="mb-3">
              <label class="form-label small">Tipo</label>
              <%= select_tag :media_type, options_for_select([["Vinilo", "vinyl"], ["CD", "cd"]], params[:media_type]), include_blank: "Todos", class: "form-select form-select-sm" %>
            </div>

            <div class="mb-3">
              <label class="form-label small">Estado</label>
              <%= select_tag :state, options_for_select([["Nuevo", "new_item"], ["Usado", "used_item"]], params[:state]), include_blank: "Todos", class: "form-select form-select-sm" %>
            </div>

            <div class="mb-3">
              <label class="form-label small">A√±o de ingreso</label>
              <%= number_field_tag :year, params[:year], class: "form-control form-control-sm", placeholder: "Ej: 2024", min: 1900, max: 2100 %>
            </div>

            <div class="d-grid gap-2">
              <%= submit_tag "Buscar", class: "btn btn-primary btn-sm" %>
              <%= link_to "Limpiar", storefront_path, class: "btn btn-outline-secondary btn-sm" %>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Navegaci√≥n por g√©neros -->
      <div class="card shadow-sm mt-3">
        <div class="card-header bg-secondary text-white">
          <strong>üé∏ G√©neros</strong>
        </div>
        <div class="list-group list-group-flush">
          <% @genres.each do |genre| %>
            <%= link_to genre.name, storefront_path(genre_id: genre.id), class: "list-group-item list-group-item-action #{'active' if params[:genre_id].to_s == genre.id.to_s}" %>
          <% end %>
        </div>
      </div>
    </div>

    <!-- CONTENIDO PRINCIPAL: Grid de productos -->
    <div class="col-lg-9">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">üéµ Nuestros Discos</h2>
        <span class="badge bg-secondary"><%= @products.size %> productos</span>
      </div>

      <% if @products.any? %>
        <div class="row row-cols-1 row-cols-sm-2 row-cols-xl-3 g-4">
          <% @products.each do |product| %>
            <div class="col">
              <div class="card h-100 shadow-sm product-card">
                <!-- Imagen de portada -->
                <% if product.cover_image.attached? %>
                  <%= link_to storefront_product_path(product) do %>
                    <%= image_tag product.cover_image.variant(resize_to_fill: [300, 300]), class: "card-img-top", alt: product.name %>
                  <% end %>
                <% else %>
                  <div class="card-img-top bg-secondary d-flex align-items-center justify-content-center" style="height: 200px;">
                    <span class="text-white-50">üéµ</span>
                  </div>
                <% end %>

                <div class="card-body">
                  <h6 class="card-title mb-1">
                    <%= link_to product.name, storefront_product_path(product), class: "text-decoration-none text-dark" %>
                  </h6>
                  <p class="card-text small text-muted mb-2"><%= product.author %></p>

                  <!-- Badges -->
                  <div class="d-flex flex-wrap gap-1 mb-2">
                    <span class="badge <%= product.media_type_vinyl? ? 'badge-vinyl' : 'badge-cd' %>">
                      <%= product.media_type_vinyl? ? "Vinilo" : "CD" %>
                    </span>
                    <span class="badge <%= product.state_new_item? ? 'bg-success' : 'bg-warning text-dark' %>">
                      <%= product.state_new_item? ? "Nuevo" : "Usado" %>
                    </span>
                  </div>

                  <p class="card-text small text-muted" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                    <%= product.description %>
                  </p>
                </div>

                <div class="card-footer bg-white border-top-0">
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="h5 mb-0 text-success">$<%= number_with_precision(product.unit_price, precision: 2) %></span>
                    <small class="text-muted">
                      <% if product.stock > 0 %>
                        <span class="text-success">‚úì <%= product.stock %> en stock</span>
                      <% else %>
                        <span class="text-danger">Sin stock</span>
                      <% end %>
                    </small>
                  </div>
                </div>

                <div class="card-footer bg-transparent pt-0">
                  <%= link_to "Ver detalle ‚Üí", storefront_product_path(product), class: "btn btn-outline-dark btn-sm w-100" %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="alert alert-info text-center py-5">
          <h4>üòï No encontramos productos</h4>
          <p class="mb-0">No hay productos que coincidan con tu b√∫squeda.</p>
          <%= link_to "Ver todos los productos", storefront_path, class: "btn btn-primary mt-3" %>
        </div>
      <% end %>
    </div>
  </div>
</div>