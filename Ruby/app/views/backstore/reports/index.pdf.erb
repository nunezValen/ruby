<div style="font-family: Arial, Helvetica, sans-serif; padding: 25px;">

  <!-- Encabezado -->
  <div style="text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #000;">
    <h1 style="margin: 0; font-size: 24px; color: #000;">REPORTE DE VENTAS</h1>
    <p style="margin: 5px 0; font-size: 14px;">
      Generado el <%= l(Time.current, format: :long) %>
    </p>

    <% if @start_date.present? || @end_date.present? || @employee.present? || @genre_name.present? %>
      <p style="margin: 8px 0 0 0; font-size: 13px; color: #444;">
        Filtros aplicados:
      </p>
      <ul style="margin: 5px 0 0 0; padding-left: 18px; font-size: 12px; color: #444; text-align: left; display: inline-block;">
        <% if @start_date.present? || @end_date.present? %>
          <li>
            Rango de fechas:
            <strong><%= @start_date.presence || "—" %> / <%= @end_date.presence || "—" %></strong>
          </li>
        <% end %>
        <% if @employee.present? %>
          <li>
            Empleado:
            <strong><%= @employee %></strong>
          </li>
        <% end %>
        <% if @genre_name.present? %>
          <li>
            Genero:
            <strong><%= @genre_name %></strong>
          </li>
        <% end %>
      </ul>
    <% end %>
  </div>

  <!-- Métricas principales -->
  <div style="margin-bottom: 30px;">
    <h2 style="font-size: 18px; margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px;">
      Resumen general
    </h2>

    <% if (@total_sales.to_i + @total_cancelled.to_i).zero? %>
      <p style="font-size: 14px; margin: 10px 0 0 0;">
        No se encontraron ventas para el período y filtros seleccionados.
      </p>
    <% else %>
      <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
        <tr>
          <td style="padding: 10px; border: 1px solid #000; font-weight: bold;">Total recaudado (ventas activas)</td>
          <td style="padding: 10px; border: 1px solid #000;">$ <%= number_with_precision(@total_revenue, precision: 2) %></td>
        </tr>
        <tr>
          <td style="padding: 10px; border: 1px solid #000; font-weight: bold;">Ventas activas</td>
          <td style="padding: 10px; border: 1px solid #000;"><%= @total_sales %></td>
        </tr>
        <tr>
          <td style="padding: 10px; border: 1px solid #000; font-weight: bold;">Productos vendidos</td>
          <td style="padding: 10px; border: 1px solid #000;"><%= @total_items %></td>
        </tr>
      </table>
    <% end %>
  </div>

  <!-- Sección cancelaciones -->
  <div style="margin-bottom: 30px;">
    <h2 style="font-size: 18px; margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px;">
      Cancelaciones
    </h2>

    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
      <tr>
        <td style="padding: 10px; border: 1px solid #000; font-weight: bold;">
          Monto perdido
        </td>
        <td style="padding: 10px; border: 1px solid #000;">
          $ <%= number_with_precision(@lost_revenue, precision: 2) %>
        </td>
      </tr>
      <tr>
        <td style="padding: 10px; border: 1px solid #000; font-weight: bold;">
          Ventas canceladas
        </td>
        <td style="padding: 10px; border: 1px solid #000;"><%= @total_cancelled %></td>
      </tr>
      <tr>
        <td style="padding: 10px; border: 1px solid #000; font-weight: bold;">
          Productos en ventas canceladas
        </td>
        <td style="padding: 10px; border: 1px solid #000;"><%= @total_cancelled_items %></td>
      </tr>
    </table>
  </div>

</div>
