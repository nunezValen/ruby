<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="mb-0"><%= @product.name %></h1>
  <div class="d-flex gap-2">
    <%= link_to "Volver", backstore_products_path, class: "btn btn-outline-dark" %>
    <% unless @product.retired? %>
      <%= link_to "Editar", edit_backstore_product_path(@product), class: "btn btn-primary" %>
    <% end %>
  </div>
</div>

<div class="row g-4">
  <div class="col-lg-7">
    <div class="card shadow-sm p-4 h-100">
      <table class="table mb-4">
        <tbody>
          <tr>
            <th scope="row">Autor</th>
            <td><%= @product.author %></td>
          </tr>
          <tr>
            <th scope="row">Precio</th>
            <td>$ <%= number_with_precision(@product.unit_price, precision: 2) %></td>
          </tr>
          <tr>
            <th scope="row">Stock</th>
            <td><%= @product.stock %></td>
          </tr>
          <tr>
            <th scope="row">Estado</th>
            <td><%= @product.state == "used_item" ? "Usado" : "Nuevo" %></td>
          </tr>
          <tr>
            <th scope="row">Tipo</th>
            <td><%= @product.media_type == "vinyl" ? "Vinilo" : "CD" %></td>
          </tr>
          <tr>
            <th scope="row">Ingreso</th>
            <td><%= l(@product.received_on) if @product.received_on %></td>
          </tr>
          <tr>
            <th scope="row">Última modificación</th>
            <td><%= l(@product.updated_at, format: :short) %></td>
          </tr>
          <% if @product.retired_at? %>
            <tr>
              <th scope="row">Fecha de baja</th>
              <td><%= l(@product.retired_at, format: :short) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <p class="mb-4"><%= simple_format(@product.description) %></p>

      <div class="mb-4">
        <p class="fw-semibold mb-2">Géneros</p>
        <% if @product.genres.any? %>
          <% @product.genres.each do |genre| %>
            <span class="genre-pill"><%= genre.name %></span>
          <% end %>
        <% else %>
          <span class="text-muted">Sin géneros asociados.</span>
        <% end %>
      </div>

      <div class="d-flex gap-2">
        <% unless @product.retired? %>
          <%= button_to "Dar de baja",
                        soft_delete_backstore_product_path(@product),
                        method: :patch,
                        class: "btn btn-primary",
                        form: { data: { action: "submit->confirm-modal#open",
                                        confirm_message: "¿Dar de baja este producto?" } } %>
        <% else %>
          <span class="badge bg-secondary align-self-center">Producto dado de baja</span>
        <% end %>
      </div>
    </div>
  </div>

  <div class="col-lg-5">
    <div class="card shadow-sm p-4">
      <h2 class="h5 mb-3">Imagen de portada</h2>
      <% if @product.cover_image.attached? %>
        <%= image_tag @product.cover_image, class: "img-fluid image-preview", style: "max-width: 100%; height: auto;", alt: @product.name %>
      <% else %>
        <p class="text-muted mb-0">Sin imagen de portada cargada.</p>
      <% end %>
    </div>

    <% if @product.gallery.attached? && @product.gallery.any? %>
      <div class="card shadow-sm p-4 mt-4">
        <h2 class="h5 mb-3">Galería de imágenes</h2>
        <div class="row g-2">
          <% @product.gallery.each do |image| %>
            <div class="col-6">
              <%= image_tag image, class: "img-fluid rounded", style: "max-width: 100%; height: auto;", alt: "Imagen de galería" %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <% if @product.audio_preview.attached? %>
      <div class="card shadow-sm p-4 mt-4">
        <h2 class="h5 mb-3">Audio de muestra</h2>
        <%= audio_tag url_for(@product.audio_preview), controls: true, class: "w-100" %>
      </div>
    <% end %>
  </div>
</div>
